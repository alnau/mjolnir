# mjolnir - программа для анализа профиля лазерного пучка

Изначально программа разрабатывалась для ускорения процесса измерений Малоуглового Рассеяния для стержней Калий Гадолиниевого Вольфрамата (Nd:KGW). Случайным образом 
был реализован интерфейс, а также добавлена возможность измерения клиновидности стержня. В дальнейшем, возможности программы будут расширяться по мере появления новых задач и требований

## Возможности программы:
- Захват изображений с камер DCx/uc480 от ThorLabs, а также с обычных USB камер
- Автоматический поиск направления большой оси пучка и построение распределения интенсивности вдоль него
- Вычисление радиуса, в котором содержится 86.5% интенсивности (радиус гаусова пучка $w(z_{sensor})$)
- Определение клиновидности стержня (угол между нормалями входной и выходной апертур)
- Подготовка отчета

## Алгоритм вычисления направления большой большой оси
Для поиска направления большой оси пучка используется алгоритм дифференциальной эволюции (Differential Evolution) c целевой функцией, возвращающей площадь под кривой интенсивности вдоль 
тестового направления. Программа ищет направление, где эта величина максимальна. Так как данные об интенсивности пучка были получены из изображения с камеры, координаты точек тестовой линии, вдоль которой проводится оптимизация вычисляются с помощью
алгоритма Брэзенхэма. На текущий момент этот метод работает достаточно хорошо, но дает некорректные данные в случае, если наклон тестовой кривой слишком большой. Этот баг будет исправлен
в будущем (надеюсь)

## Алгоритм вычисления радиуса пучка
В качестве критерия качества кристалла с точки зрения силы малоуглового рассеяния использован радиус пучка $w(z_{sensor})$ в предположении, того, что пучок гауссов.
Для начала происходит нормализация изображения и удаление шумовой подложки (зануление интенсивностей пикселей, имеющих интенсивность меньше, чем CUTOFF_THRESHOLD (=5)). 
После этого, находятся координаты "центра масс" распределения который можно трактовать как центр пучка Начало координат совпадает с центром масс по интенсивности $(x_{cm},y_{cm})$:
$$
x_{cm} = \int_\Omega xI(x,y)dxdy \\
y_{cm} = \int_\Omega yI(x,y)dxdy,
$$
где $I(r)$ - распределение интенсивности по "сетке" захваченного изображения, $\Omega$ - область изображения. В дальнейших вычислениях эта точка будет считаться центром полярной системы координат.

Далее в новой системе координат вычисляется интеграл интенсивности по максимально возможному 
радиусу, определяемому как минимальное расстояние до границ изображения:
$$
I_{max} = 2\pi\int_0^{r_{max}}I(r)rdr 
$$ 

В конце концов, радиус 86.5% энергии находится  помощью решения уравнения:

$$
g(r) = \frac{2\pi\int_0^rI(r)rdr}{I_{max}} = 0.865,
$$

относительно $r$ с помощью метода дихотомии. 
## Алгоритм вычисления угла клиновидности
Предположим, нормаль одной из апертур кристалла направлена параллельно оптической оси системы. тогда в случае отклонения нормали второй грани на угол $\alpha$ от направления 
оптической оси, изображение пучка сместится на $\delta l$ в плоскости матрицы камеры. Вращая стержень вокруг оси, можно найти максимальное отклонение $d_{max}$. Тогда угол можно выразить как:

$\alpha = \frac{\arctan(d_{max}/2L)}{n_{KGW}-1},$

где $L$ - база от кристалла до матрицы, $n_{KGW}$ - показатель преломления KGW
